# 新功能说明

## 功能概述

本次更新新增了以下功能：

### 1. 地图右键创建房东

**功能描述：** 可以在地图上通过右键点击来创建新房东，自动获取该位置的 GPS 坐标和地址。

**使用方法：**
1. 在地图视图中，找到想要标记的位置
2. 右键点击该位置
3. 在弹出的对话框中，输入房东别名（可选）
4. 点击确认，系统会自动创建房东并标记在地图上
5. 新创建的房东会自动打开详情页面，可以继续完善其他信息

**注意事项：**
- 新创建的房东初始没有照片，需要后续上传
- GPS 坐标会自动填充
- 地址会通过逆地理编码自动获取
- 取消对话框则不会创建房东

---

### 2. 房东详情中上传图片

**功能描述：** 在房东详情的基本信息 Tab 中，可以为房东上传新图片，图片会自动保存到用户选择的文件夹中。

**使用方法：**
1. 打开任意房东的详情页面
2. 在"基本信息" Tab 中，找到照片展示区下方的上传区域
3. 点击上传区域
4. 在弹出的文件选择器中，选择一张或多张图片
5. 图片会自动保存到用户之前选择的照片文件夹
6. 上传成功后，图片会立即显示在照片列表中
7. 系统会自动保存房东信息

**注意事项：**
- 首次使用前，需要在主页面选择照片文件夹并授予**读写权限**
- 支持同时上传多张图片
- 上传的图片会以 `upload_时间戳_随机码.扩展名` 的格式命名
- 支持的格式：jpg, png, gif 等常见图片格式

---

### 3. 文件夹写权限支持

**功能描述：** 现在选择照片文件夹时，系统会请求读写权限，以支持图片上传功能。

**使用方法：**
1. 在主页面点击"选择照片文件夹"
2. 在浏览器弹出的权限对话框中，选择"查看文件"（读写权限）
3. 选择文件夹后，即可使用上传功能

**注意事项：**
- 旧版本只有读权限，无法上传图片
- 如果之前已选择文件夹但没有写权限，需要重新选择文件夹来获取写权限
- 浏览器会记住权限设置，下次打开网站时无需重新授权

---

## 使用场景示例

### 场景 1：在地图上发现新房东
1. 在某个地点拍摄了房东信息
2. 在地图上右键点击该位置创建房东
3. 在详情页面上传刚拍摄的照片
4. 填写电话、类型等基本信息
5. 保存完成

### 场景 2：为已有房东补充图片
1. 发现某个房东缺少照片或需要补充新照片
2. 打开该房东的详情页面
3. 在上传区域选择并上传新图片
4. 系统自动保存

---

## 技术说明

### 文件命名规则
- 上传的图片：`upload_{时间戳}_{随机码}.{扩展名}`
- 手动创建的房东：`folderId` 为 `manual-create`
- 用户上传的图片：`folderId` 为 `user-uploaded`

### 权限管理
- 使用 File System Access API
- 需要 Chrome 86+ 或 Edge 86+
- 权限会在浏览器中持久化保存

### 数据同步
- 上传图片后会自动保存到 IndexedDB
- 图片文件保存在用户选择的文件夹中
- 房东记录和文件系统保持同步
